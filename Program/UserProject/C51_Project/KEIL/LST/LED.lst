C51 COMPILER V9.60.0.0   LED                                                               11/01/2022 15:53:28 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\Output\LED.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE ..\..\..\UserCode\User\src\LED.c LARGE OPTIMIZE(7,SPEED) BROWSE INCDIR(.
                    -.\..\..\UserCode\Device\Include;..\..\..\UserCode\StdDriver\inc;..\..\..\UserCode\User\ins;..\..\..\UserCode\StdDriver\s
                    -rc;..\..\..\UserCode\StdDriver\lib) DEBUG OBJECTEXTEND PRINT(.\LST\LED.lst) TABS(2) OBJECT(.\Output\LED.obj)

line level    source

   1          #include "ML51.h"
   2          /**********************************************************************
   3            PWM frequency = Fpwm/((PWMPH,PWMPL) + 1) <Fpwm = Fsys/PWM_CLOCK_DIV> 
   4                          = (24MHz/8)/(0x456 + 1)
   5                          = 2.7KHz
   6          ***********************************************************************/
   7          void LED_Init(void)
   8          { 
   9   1          /*设置io口推挽输出*/
  10   1           // GPIO_SetMode(BLU_PORT_R ,BLU_R_PIN,GPIO_MODE_PUSHPULL);
  11   1           // GPIO_SetMode(BLU_PORT_GB ,BLU_G_PIN|BLU_B_PIN,GPIO_MODE_PUSHPULL);
  12   1          GPIO_SetMode(LAMP_PORT ,LAMP_R_PIN|LAMP_G_PIN|LAMP_B_PIN,GPIO_MODE_PUSHPULL);
  13   1          // BLU_ON();
  14   1          // LAMP_OFF();
  15   1          PWM123_ClockSource(PWM2,8);
  16   1          MFP_P43_PWM2_CH0;                               // multi function pin define P0.3 as PWM0 channel 2 out
             -put
  17   1          P43_PUSHPULL_MODE;
  18   1          PWM123_ConfigOutputChannel(PWM2,0,0x456,50);    // 2.7K输出PWM占空比50%
  19   1          set_PWM2CON0_LOAD;                              //新的周期占空比载入  //这个是蜂鸣器的驱动
  20   1          PWM0_ClockSource(PWM_FSYS,8); 
  21   1        
  22   1          MFP_P05_PWM0_CH0;//G                                                // multi function pin define P0.5 a
             -s PWM0 channel 0 output
  23   1          P05_PUSHPULL_MODE;                                              
  24   1          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,100);    // setting PWM channel 0 as 10% duty
             - high of 0x6FF PWM period = 0x00B3
  25   1          
  26   1          MFP_P04_PWM0_CH1;//B                                               // multi function pin define P0.5 as
             - PWM0 channel 0 output
  27   1          P04_PUSHPULL_MODE;                                              
  28   1          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,100);    // setting PWM channel 0 as 10% duty
             - high of 0x6FF PWM period = 0x00B3   
  29   1          
  30   1          MFP_P36_PWM0_CH5;//R                                                // multi function pin define P0.5 a
             -s PWM0 channel 0 output
  31   1          P36_PUSHPULL_MODE;                                              
  32   1          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);  
  33   1          
  34   1          
  35   1          //set_PWM0CON0_PWMRUN;//pwm0输出使能
  36   1          
  37   1          //set_PWM2CON0_PWMRUN;//pwm2输出使能
  38   1          clr_PWM2CON0_PWM2RUN;
  39   1          PWM0_RUN();
  40   1        
  41   1        
  42   1        
  43   1      }
  44          
  45          void LED_FLASH(unsigned char Times)
  46          {
  47   1      switch (Times)
C51 COMPILER V9.60.0.0   LED                                                               11/01/2022 15:53:28 PAGE 2   

  48   1      {
  49   2        case 1:
  50   2          LAMP_GREEN_ON();
  51   2          break;
  52   2        case 2:
  53   2          LAMP_YELLOW_ON();
  54   2          break;
  55   2        case 3:
  56   2          LAMP_RED_ON();
  57   2          break;
  58   2        
  59   2        case 4:
  60   2          LAMP_RED_ON();
  61   2          break;
  62   2      
  63   2      }
  64   1      
  65   1      }
  66          
  67          void LED_Buz(void)
  68          {
  69   1         static unsigned char BuzTime=0;
  70   1        if(Get_Light_Sta()==Light_on)
  71   1        {
  72   2          if(Get_Co2Value()<=1000)
  73   2          {
  74   3          LAMP_GREEN_ON();
  75   3          }
  76   2          else if(Get_Co2Value()<=1400)
  77   2          {
  78   3          LAMP_YELLOW_ON();
  79   3          }
  80   2          else if(Get_Co2Value()<=1800)
  81   2          {
  82   3          LAMP_RED_ON();
  83   3          }
  84   2          else
  85   2          {
  86   3          LAMP_RED_ON();
  87   3          if(Get_Bell_Sta()==Bell_off)
  88   3          {
  89   4          clr_PWM2CON0_PWM2RUN;
  90   4          }
  91   3          else if(Get_Bell_Sta()==Bell_on)
  92   3          {
  93   4            BuzTime++;
  94   4            if(BuzTime<50)
  95   4            {
  96   5            set_PWM2CON0_PWMRUN;
  97   5            }
  98   4            else if(BuzTime<100)
  99   4            {
 100   5            clr_PWM2CON0_PWM2RUN;
 101   5            }
 102   4            else BuzTime=0;
 103   4            } 
 104   3          }
 105   2        
 106   2        }
 107   1        else if(Get_Light_Sta()==Light_off)
 108   1        {
 109   2        LAMP_OFF();
C51 COMPILER V9.60.0.0   LED                                                               11/01/2022 15:53:28 PAGE 3   

 110   2        clr_PWM2CON0_PWM2RUN;
 111   2        }
 112   1      
 113   1        if(Get_Co2Value()>1800)
 114   1        {
 115   2          if(Get_Bell_Sta()==Bell_off)
 116   2          {
 117   3          //clr_PWM2CON0_PWM2RUN;
 118   3          PWM123_ConfigOutputChannel(PWM2,0,0x456,0);    // 2.7K输出PWM占空比50%
 119   3          set_PWM2CON0_LOAD; 
 120   3          set_PWM2CON0_PWMRUN;  
 121   3          }
 122   2          else if(Get_Bell_Sta()==Bell_on)
 123   2          {
 124   3            BuzTime++;
 125   3            if(BuzTime<50)
 126   3            {
 127   4            
 128   4            PWM123_ConfigOutputChannel(PWM2,0,0x456,50);    // 2.7K输出PWM占空比50% set_PWM2CON0_PWMRUN;
 129   4            set_PWM2CON0_LOAD;  
 130   4            set_PWM2CON0_PWMRUN;  
 131   4            }
 132   3            else if(BuzTime<100)
 133   3            {
 134   4            
 135   4            PWM123_ConfigOutputChannel(PWM2,0,0x456,0);    // 2.7K输出PWM占空比50%//clr_PWM2CON0_PWM2RUN;
 136   4            
 137   4            set_PWM2CON0_LOAD; 
 138   4            set_PWM2CON0_PWMRUN;  
 139   4            }
 140   3            else BuzTime=0;
 141   3          } 
 142   2        
 143   2       
 144   2          
 145   2      
 146   2        
 147   2      }
 148   1      void RGB_Color(Color_s RGBColor)
*** ERROR C141 IN LINE 148 OF ..\..\..\UserCode\User\src\LED.c: syntax error near 'void', expected '__asm'
 149   1      {
 150   1       PWM0_STOP();
 151   1       switch (RGBColor)
 152   1       {
 153   2         case White:
 154   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,100);    //G                                  
 155   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,100);    //B                                 
             -             
 156   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);    //R
 157   2         break;
 158   2         case Red:
 159   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,0);      //G                                   
             -     
 160   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,0);      //B                                 
             -             
 161   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);    //R
 162   2         break;
 163   2         case Green:
 164   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,100);    //G                                   
             -     
 165   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,0);      //B                                 
             -             
C51 COMPILER V9.60.0.0   LED                                                               11/01/2022 15:53:28 PAGE 4   

 166   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,0);      //R
 167   2         break;
 168   2         case Blue:
 169   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,0);      //G                                   
             -     
 170   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,100);    //B                                 
             -             
 171   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,0);      //R
 172   2         break;
 173   2         case Yellow:
 174   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,100);    //G                                   
             -     
 175   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,0);      //B                                 
             -             
 176   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);    //R
 177   2         break;
 178   2         case Purple:
 179   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,0);      //G                                   
             -     
 180   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,100);    //B                                 
             -             
 181   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);    //R
 182   2         break;
 183   2         case Orange:
 184   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,70);     //G                                   
             -     
 185   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,20);      //B                                
             -              
 186   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,100);    //R 
 187   2         break;
 188   2         case Cyan:
 189   2          PWM0_ConfigOutputChannel(0,Independent,EdgeAligned,0x456,100);    //G                                   
             -     
 190   2          PWM0_ConfigOutputChannel(1,Independent,EdgeAligned,0x456,100);    //B                                 
             -             
 191   2          PWM0_ConfigOutputChannel(5,Independent,EdgeAligned,0x456,0);      //R
 192   2         break;
 193   2         default:
 194   2         break;
 195   2       }
 196   1       PWM0_RUN();
 197   1       
 198   1      
 199   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
